syntax = "proto3";

package aggregation_server;

service AggregationServer {
  rpc Configure (ConfigureRequest) returns (ConfigureResponse);
  rpc Aggregate (AggregateRequest) returns (AggregateResponse);
  rpc AggregateBatch (AggregateBatchRequest) returns (AggregateBatchResponse);
  rpc Cleanup (CleanupRequest) returns (CleanupResponse);
}

message ConfigureRequest {
  string request_id = 1;
  int32 num_of_workers = 2;
}

message ConfigureResponse {
  string status = 1;
}

message AggregateRequest {
  string request_id = 1;
  string aggregation_type = 2;
  repeated double vectors = 3;
  bytes tensor = 4;
}

message AggregateResponse {
  repeated double result = 1;
  bytes tensor = 2;
}

message Operation {
  string aggregation_type = 1;
  repeated double vectors = 2;
  bytes tensor = 3;
}

message AggregateBatchRequest {
  string request_id = 1;
  repeated Operation operations = 2;
}

message AggregateBatchResponse {
  repeated double results = 1;
  repeated int32 offsets = 2;
  repeated bytes tensors = 3;
}

message CleanupRequest {
  string request_id = 1;
}

message CleanupResponse {
  string status = 1;
}
